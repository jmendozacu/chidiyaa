<?xml version="1.0"?>
<config>
    <modules>
        <TM_Cache>
            <version>1.4.10</version>
        </TM_Cache>
    </modules>

    <global>
        <models>
            <tmcache>
                <class>TM_Cache_Model</class>
                <resourceModel>tmcache_resource</resourceModel>
            </tmcache>
            <tmcache_resource>
                <class>TM_Cache_Model_Resource</class>
                <entities>
                    <log>
                        <table>tm_cache_log</table>
                    </log>
                </entities>
            </tmcache_resource>
        </models>
        <resources>
            <tm_cache_setup>
                <setup>
                    <module>TM_Cache</module>
                </setup>
            </tm_cache_setup>
        </resources>
        <blocks>
            <tmcache>
                <class>TM_Cache_Block</class>
            </tmcache>
            <core>
                <rewrite>
                    <messages>TM_Cache_Block_Core_Messages</messages>
                </rewrite>
            </core>
            <page>
                <rewrite>
                    <html_header>TM_Cache_Block_Page_Html_Header</html_header>
                </rewrite>
            </page>
        </blocks>
        <helpers>
            <tmcache>
                <class>TM_Cache_Helper</class>
            </tmcache>
        </helpers>
        <cache>
            <types>
                <tmcache>
                    <label>TM Full Page Cache</label>
                    <description>Full page cache by templates-master.com</description>
                    <tags>TM_CACHE</tags>
                </tmcache>
            </types>
        </cache>
        <!-- @deprecated (remove in next release). This logic was copied to TM_Core -->
        <remote_addr_headers>
            <header_tmcache_http_x_real_ip>HTTP_X_REAL_IP</header_tmcache_http_x_real_ip>
            <header_tmcache_http_x_forewarded_for>HTTP_X_FORWARDED_FOR</header_tmcache_http_x_forewarded_for>
        </remote_addr_headers>
        <events>
            <model_save_commit_after>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>onSaveAfter</method>
                    </tmcache>
                </observers>
            </model_save_commit_after>
        </events>
        <tmcache_config>
            <dynamic_block_types>
                <catalog>
                    <compare>catalog/product_compare_sidebar</compare>
                    <!-- <new>catalog/product_new</new> --> <!-- Do not use it as dynamic: cached form_key issue -->
                </catalog>
                <checkout>
                    <cart_mini>checkout/cart_minicart</cart_mini>
                    <cart_sidebar>checkout/cart_sidebar</cart_sidebar>
                    <links>checkout/links</links>
                </checkout>
                <core>
                    <messages>core/messages</messages>
                </core>
                <easybanner>
                    <placeholder>easybanner/placeholder</placeholder>
                    <banner>easybanner/banner</banner>
                    <widget_placeholder>easybanner/widget_placeholder</widget_placeholder>
                    <widget_banner>easybanner/widget_banner</widget_banner>
                </easybanner>
                <highlight>
                     <viewed>highlight/product_reports_viewed</viewed>
                     <!-- <bestseller>highlight/product_bestseller</bestseller> -->
                     <!-- <new>highlight/product_new</new> -->
                     <!-- <popular>highlight/product_popular</popular> -->
                     <!-- <review>highlight/review_new</review> -->
                </highlight>
                <page>
                    <welcome>page/html_welcome</welcome>
                </page>
                <poll>
                    <active>poll/activePoll</active>
                </poll>
                <reports>
                    <compared>reports/product_compared</compared>
                    <viewed>reports/product_viewed</viewed>
                    <widget_compared>reports/product_widget_compared</widget_compared>
                    <widget_viewed>reports/product_widget_viewed</widget_viewed>
                </reports>
                <sales>
                    <reorder>sales/reorder_sidebar</reorder>
                </sales>
                <smartsuggest>
                    <suggest>smartsuggest/suggest</suggest>
                    <widget_suggest>smartsuggest/widget_suggest</widget_suggest>
                    <wrapper>smartsuggest/wrapper</wrapper>
                </smartsuggest>
                <tm_dailydeals>
                    <custom>tm_dailydeals/product_highlight_custom</custom>
                    <predefined>tm_dailydeals/product_highlight_predefined</predefined>
                </tm_dailydeals>
                <wishlist>
                    <sidebar>wishlist/customer_sidebar</sidebar>
                    <links>wishlist/links</links>
                </wishlist>
            </dynamic_block_types>
        </tmcache_config>
    </global>

    <frontend>
        <events>
            <tmcache_cache_hit>
                <observers>
                    <log>
                        <class>tmcache/observer</class>
                        <method>logHit</method>
                    </log>
                </observers>
            </tmcache_cache_hit>
            <tmcache_cache_miss>
                <observers>
                    <log>
                        <class>tmcache/observer</class>
                        <method>logMiss</method>
                    </log>
                </observers>
            </tmcache_cache_miss>
            <controller_action_predispatch>
                <observers>
                    <tmcache>
                        <class>tmcache/processor</class>
                        <method>processRequest</method>
                    </tmcache>
                </observers>
            </controller_action_predispatch>
            <controller_action_postdispatch>
                <observers>
                    <tmcache>
                        <class>tmcache/processor</class>
                        <method>processResponse</method>
                    </tmcache>
                </observers>
            </controller_action_postdispatch>
            <core_block_abstract_to_html_after>
                <observers>
                    <tmcache>
                        <class>tmcache/processor</class>
                        <method>processBlockHtml</method>
                    </tmcache>
                </observers>
            </core_block_abstract_to_html_after>
            <!-- custom_layout_xml compatibility -->
            <catalog_controller_product_init_after>
                <observers>
                    <tmcache>
                        <class>tmcache/observer</class>
                        <method>addCatalogProductLayoutUpdate</method>
                    </tmcache>
                </observers>
            </catalog_controller_product_init_after>
            <catalog_controller_category_init_after>
                <observers>
                    <tmcache>
                        <class>tmcache/observer</class>
                        <method>addCatalogCategoryLayoutUpdate</method>
                    </tmcache>
                </observers>
            </catalog_controller_category_init_after>
            <cms_page_render>
                <observers>
                    <tmcache>
                        <class>tmcache/observer</class>
                        <method>addCmsPageLayoutUpdate</method>
                    </tmcache>
                </observers>
            </cms_page_render>
            <!-- custom_layout_xml compatibility -->
            <tm_cache_prepare_cache_key>
                <observers>
                    <last_category_id>
                        <class>tmcache/observer</class>
                        <method>addLastCategoryIdToCacheKey</method>
                    </last_category_id>
                </observers>
            </tm_cache_prepare_cache_key>
        </events>
    </frontend>

    <admin>
        <routers>
            <adminhtml>
                <args>
                    <modules>
                        <tmcache after="Mage_Adminhtml">TM_Cache_Adminhtml</tmcache>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>

    <adminhtml>
        <translate>
            <modules>
                <TM_Cache>
                    <files>
                        <default>TM_Cache.csv</default>
                    </files>
                </TM_Cache>
            </modules>
        </translate>
        <layout>
            <updates>
                <tmcache>
                     <file>tm/cache.xml</file>
                </tmcache>
            </updates>
        </layout>
        <events>
            <model_delete_before>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>onDeleteBefore</method>
                    </tmcache>
                </observers>
            </model_delete_before>
            <model_delete_commit_after>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>onDeleteAfter</method>
                    </tmcache>
                </observers>
            </model_delete_commit_after>
            <catalogrule_after_apply>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>onCatalogRuleApply</method>
                    </tmcache>
                </observers>
            </catalogrule_after_apply>
            <category_move>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>onCategoryMove</method>
                    </tmcache>
                </observers>
            </category_move>
            <controller_action_postdispatch_adminhtml_catalog_product_action_attribute_save>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>cleanProductsCache</method>
                    </tmcache>
                </observers>
            </controller_action_postdispatch_adminhtml_catalog_product_action_attribute_save>
            <controller_action_postdispatch_adminhtml_catalog_product_massStatus>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>cleanProductsCache</method>
                    </tmcache>
                </observers>
            </controller_action_postdispatch_adminhtml_catalog_product_massStatus>
            <!-- <controller_action_postdispatch_adminhtml_system_config_save>
                <observers>
                    <tmcache>
                        <class>tmcache/cache_cleaner</class>
                        <method>onConfigSave</method>
                    </tmcache>
                </observers>
            </controller_action_postdispatch_adminhtml_system_config_save> -->
        </events>
    </adminhtml>

    <crontab>
        <jobs>
            <tmcache_remove_old_cache>
                <schedule>
                    <cron_expr>30 2 * * *</cron_expr> <!-- Every Day at 2:30AM -->
                </schedule>
                <run>
                    <model>tmcache/observer::removeOldRecordsWithNoHits</model>
                </run>
            </tmcache_remove_old_cache>
            <tmcache_log_clear>
                <schedule>
                    <cron_expr>0 3 * * 2</cron_expr> <!-- Every Tuesday at 3AM -->
                </schedule>
                <run>
                    <model>tmcache/observer::clearLog</model>
                </run>
            </tmcache_log_clear>
        </jobs>
    </crontab>

    <default>
        <tmcache>
            <general>
                <automatic_clean>1</automatic_clean>
                <lifetime><![CDATA[a:1:{s:1:"1";a:2:{s:3:"url";s:5:"*/*/*";s:8:"lifetime";s:6:"864000";}}]]></lifetime>
            </general>
            <registry>
                <product>0</product>
                <category>0</category>
            </registry>
            <cache>
                <lifetime>864000</lifetime> <!-- 10 days -->
            </cache>
            <cron>
                <old_cache_records_auto_remove>1</old_cache_records_auto_remove>
                <old_cache_records_days>2</old_cache_records_days>
                <old_log_records_days>8</old_log_records_days>
            </cron>
        </tmcache>
    </default>
</config>
