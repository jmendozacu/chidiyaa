if(void 0===Product)var Product={};Product.Bundle=Class.create(),Product.Bundle.prototype={initialize:function(e){if(this.config=e,e.defaultValues)for(var i in e.defaultValues)if(this.config.options[i].isMulti){for(var t=new Array,o=0;o<e.defaultValues[i].length;o++)t.push(e.defaultValues[i][o]);this.config.selected[i]=t}else this.config.selected[i]=new Array(e.defaultValues[i]+"");this.reloadPrice()},changeSelection:function(e){var i=e.id.split("-");if(this.config.options[i[2]].isMulti){if(selected=new Array,"SELECT"==e.tagName)for(var t=0;t<e.options.length;t++)e.options[t].selected&&""!=e.options[t].value&&selected.push(e.options[t].value);else if("INPUT"==e.tagName){selector=i[0]+"-"+i[1]+"-"+i[2],selections=$$("."+selector);for(t=0;t<selections.length;t++)selections[t].checked&&""!=selections[t].value&&selected.push(selections[t].value)}this.config.selected[i[2]]=selected}else{""!=e.value?this.config.selected[i[2]]=new Array(e.value):this.config.selected[i[2]]=new Array,this.populateQty(i[2],e.value);var o=$("bundle-option-"+i[2]+"-tier-prices"),n="";""!=e.value&&1==this.config.options[i[2]].selections[e.value].customQty&&(n=this.config.options[i[2]].selections[e.value].tierPriceHtml),o.update(n)}this.reloadPrice()},reloadPrice:function(){var e=0,i=0,t=0;for(var o in this.config.selected)if(this.config.options[o])for(var n=0;n<this.config.selected[o].length;n++){var c=this.selectionPrice(o,this.config.selected[o][n]);e+=Number(c[0]),i+=Number(c[1]),t+=Number(c[2])}if(taxCalcMethod==CACL_TOTAL_BASE){var s=e.toFixed(10),r=t.toFixed(10)-s;e=t-Math.round(100*r)/100}return"0"==this.config.priceType&&(e=Math.round(100*e)/100,i=Math.round(100*i)/100,t=Math.round(100*t)/100),$(document).fire("bundle:reload-price",{price:e,priceInclTax:t,dispositionPrice:i,bundle:this}).noReloadPrice||(optionsPrice.specialTaxPrice="true",optionsPrice.changePrice("bundle",e),optionsPrice.changePrice("nontaxable",i),optionsPrice.changePrice("priceInclTax",t),optionsPrice.reload()),e},selectionPrice:function(e,i){if(""==i||"none"==i||void 0===this.config.options[e].selections[i])return 0;var t,o,n=null;if(n=1!=this.config.options[e].selections[i].customQty||this.config.options[e].isMulti?this.config.options[e].selections[i].qty:$("bundle-option-"+e+"-qty-input")?$("bundle-option-"+e+"-qty-input").value:1,"0"==this.config.priceType){price=this.config.options[e].selections[i].price,tierPrice=this.config.options[e].selections[i].tierPrice;for(var c=0;c<tierPrice.length;c++)Number(tierPrice[c].price_qty)<=n&&Number(tierPrice[c].price)<=price&&(price=tierPrice[c].price,t=tierPrice[c].priceInclTax,o=tierPrice[c].priceExclTax)}else selection=this.config.options[e].selections[i],"0"==selection.priceType?price=selection.priceValue:price=this.config.basePrice*selection.priceValue/100;var s=this.config.options[e].selections[i].plusDisposition+this.config.options[e].selections[i].minusDisposition;return this.config.specialPrice&&(newPrice=price*this.config.specialPrice/100,price=Math.min(newPrice,price)),selection=this.config.options[e].selections[i],void 0!==t&&void 0!==o?(priceInclTax=t,price=o):void 0!==selection.priceInclTax?(priceInclTax=selection.priceInclTax,price=void 0!==selection.priceExclTax?selection.priceExclTax:selection.price):priceInclTax=price,"1"==this.config.priceType||taxCalcMethod==CACL_TOTAL_BASE?new Array(price*n,s*n,priceInclTax*n):taxCalcMethod==CACL_UNIT_BASE?(price=(Math.round(100*price)/100).toString(),s=(Math.round(100*s)/100).toString(),priceInclTax=(Math.round(100*priceInclTax)/100).toString(),new Array(price*n,s*n,priceInclTax*n)):(price=(Math.round(price*n*100)/100).toString(),s=(Math.round(s*n*100)/100).toString(),priceInclTax=(Math.round(priceInclTax*n*100)/100).toString(),new Array(price,s,priceInclTax))},populateQty:function(e,i){""!=i&&"none"!=i?1==this.config.options[e].selections[i].customQty?this.showQtyInput(e,this.config.options[e].selections[i].qty,!0):this.showQtyInput(e,this.config.options[e].selections[i].qty,!1):this.showQtyInput(e,"0",!1)},showQtyInput:function(e,i,t){elem=$("bundle-option-"+e+"-qty-input"),elem.value=i,elem.disabled=!t,t?elem.removeClassName("qty-disabled"):elem.addClassName("qty-disabled")},changeOptionQty:function(e,i){var t=!0;void 0!==i&&(8!=i.keyCode&&46!=i.keyCode||(t=!1)),t&&(0==Number(e.value)||isNaN(Number(e.value)))&&(e.value=1),parts=e.id.split("-"),optionId=parts[2],this.config.options[optionId].isMulti||(selectionId=this.config.selected[optionId][0],this.config.options[optionId].selections[selectionId].qty=1*e.value,this.reloadPrice())},validationCallback:function(e,i){if(void 0!=e&&void 0!=$(e)){var t=$(e).up("ul.options-list");void 0!==t&&("failed"==i?(t.removeClassName("validation-passed"),t.addClassName("validation-failed")):(t.removeClassName("validation-failed"),t.addClassName("validation-passed")))}}};
